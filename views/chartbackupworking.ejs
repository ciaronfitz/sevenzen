<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>SEVENZEN</title>
    <link rel="icon" href="/sevenzen.ico" sizes="any" type="image/svg+xml">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="/mystyles.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.js"
        integrity="sha512-ZwR1/gSZM3ai6vCdI+LVF1zSq/5HznD3ZSTk7kajkaj4D292NLuduDCO1c/NT8Id+jE58KYLKT7hXnbtryGmMg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>

<body>
    <%- include('header'); %>
        <% if (chartempty==true ) { %>
            <div class="alert alert-danger" role="alert">You have not logged any emotion data. Come back after logging
                to see your chart.</div>
            <% } else { %>
                <main class="container">
                    <div class="card mb-3">

                        <canvas id="avgcanvas" height="500"></canvas>

                    </div>
                </main>
                <% } %>

                    <script>

                        //convert data from ejs to js for averages graph
                        var chartinput = {
                            avg_enjoyment: <%= chartinput.avg_enjoyment %>,
                            avg_sadness: <%= chartinput.avg_sadness %>,
                            avg_anger: <%= chartinput.avg_anger %>,
                            avg_contempt: <%= chartinput.avg_contempt %>,
                            avg_disgust: <%= chartinput.avg_disgust %>,
                            avg_fear: <%= chartinput.avg_fear %>,
                            avg_surprise: <%= chartinput.avg_surprise %>
                        };

                        console.log('averages input ready');

                        //create averages chart
                        var yvalsAverages = [chartinput.avg_enjoyment, chartinput.avg_sadness, chartinput.avg_anger, chartinput.avg_contempt, chartinput.avg_disgust, chartinput.avg_fear, chartinput.avg_surprise];
                        const xlabelsAverages = ["Enjoyment", "Sadness", "Anger", "Contempt", "Disgust", "Fear", "Surprise"];
                        const chartdataAverages = {
                            labels: xlabelsAverages,
                            datasets: [{
                                data: yvalsAverages,
                                lineTension: 0,
                                pointRadius: 3,
                            }]
                        };

                        const chartconfigAverages = {
                            type: 'bar',
                            data: chartdataAverages,
                            options: {
                                backgroundColor: 'rgb(109, 60, 149)',
                                animation: true,
                                maintainaspectratio: true,
                                responsive: true,
                                scales: {
                                    y: {
                                        min: 0,
                                        max: 10,
                                        beginAtZero: true
                                    }
                                },
                                plugins: {
                                    legend: { display: false },
                                    tooltip: { enabled: false },
                                    title: { display: true, text: 'Average Intensity of Each Emotion' }
                                }
                            }
                        };

                        const chartAverages = new Chart(document.getElementById('avgcanvas').getContext('2d'), chartconfigAverages);
                    </script>
</body>

</html>